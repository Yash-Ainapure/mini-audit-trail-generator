name: Wake backend every 5 minutes

on:
  schedule:
    # Runs every 5 minutes (UTC)
    - cron: '*/5 * * * *'
  workflow_dispatch:

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Curl backend URL
        env:
          PING_URL: ${{ secrets.PING_URL }}
        run: |
          set -euo pipefail
          # If PING_URL secret is not set, fall back to an example invalid URL.
          if [ -z "${PING_URL:-}" ]; then
            # Default to your deployed backend and hit a path that likely doesn't exist.
            # A 404 response still counts as a request and will keep the service awake.
            echo "PING_URL secret not set; using fallback URL https://mini-audit-trail-generator-fuja.onrender.com/nonexistent-keepalive"
            URL="https://mini-audit-trail-generator-fuja.onrender.com/nonexistent-keepalive"
          else
            URL="$PING_URL"
          fi
          echo "Pinging $URL"
          # Use a short timeout so the job doesn't hang. Allow failure (|| true)
          # because the target URL may intentionally not work.
          curl -fsS --max-time 15 "$URL" || true